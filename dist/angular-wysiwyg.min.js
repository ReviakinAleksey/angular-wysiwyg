!function(e,t){"use strict";var a=[["bold","italic","underline","strikethrough","subscript","superscript"],["format-block"],["font"],["font-size"],["font-color","hilite-color"],["remove-format"],["ordered-list","unordered-list","outdent","indent"],["left-justify","center-justify","right-justify"],["code","quote","paragraph"],["link","image"],["toggle-mode"]],n={};e.module("wysiwyg.module",["colorpicker.module"]).directive("wysiwyg",["$timeout","wysiwgGui","$compile","$window","$http",function(a,i,l,o,s){function r(r,u,c,m){function f(){v(),b(),p(),y(),h(),d()}function d(){s.get("/api/v1/users/self/files").then(function(e){r.files.user=e.data})}function g(){u.find("button.wysiwyg-fontcolor").css("color",r.fontColor)}function v(){a(function(){var e=u.find(".wysiwyg-textarea")[0],t=o.getComputedStyle(e,null);if(null!=t.fontFamily){var a=t.fontFamily.split(",")[0];a=a.slice(1,-1),-1!==r.fonts.indexOf(a)&&(r.font=a)}if(null!=t.fontSize)for(var n=0;n<r.fontSizes.length;n++){var i=r.fontSizes[n];if(i.size==t.fontSize){r.fontSize=i;break}}null!=t.color&&(r.fontColor=t.color,g())})}function b(){i.setCustomElements(r.textareaCustomMenu);var e=u.children("div.wysiwyg-menu")[0];e.appendChild(i.createMenu(r.textareaMenu)),l(e)(r)}function p(){r.$watch("disabled",function(t){e.element("div.wysiwyg-menu").find("button").each(function(){e.element(this).attr("disabled",t)}),e.element("div.wysiwyg-menu").find("select").each(function(){e.element(this).attr("disabled",t)})}),r.$watch("fontColor",g)}function y(){"true"===c.enableBootstrapTitle&&c.enableBootstrapTitle!==t&&u.find("button[title]").tooltip({container:"body"})}function h(){e.element(".wysiwyg-menu").find("button").on("click",function(){var t=e.element(this);r.$emit("wysiwyg.click",t.attr("title")||t.attr("data-original-title"))}),x.on("input keyup paste mouseup",function(){var e=x.html();"<br>"==e&&(e=""),m.$setViewValue(e)}),x.on("keydown",function(e){if(9==e.keyCode){{var t=(x.html(),window.getSelection());t.anchorOffset}e.preventDefault()}}),x.on("click keyup focus mouseup",function(){a(function(){r.isBold=r.cmdState("bold"),r.isUnderlined=r.cmdState("underline"),r.isStrikethrough=r.cmdState("strikethrough"),r.isItalic=r.cmdState("italic"),r.isSuperscript=w("SUP"),r.isSubscript=w("SUB"),r.isRightJustified=r.cmdState("justifyright"),r.isLeftJustified=r.cmdState("justifyleft"),r.isCenterJustified=r.cmdState("justifycenter"),r.isPre="pre"===r.cmdValue("formatblock"),r.isBlockquote="blockquote"===r.cmdValue("formatblock"),r.isOrderedList=r.cmdState("insertorderedlist"),r.isUnorderedList=r.cmdState("insertunorderedlist"),r.fonts.forEach(function(e){return r.cmdValue("fontname").indexOf(e)>-1?(r.font=e,!1):void 0}),r.cmdValue("formatblock").toLowerCase(),r.formatBlocks.forEach(function(e){return r.cmdValue("formatblock").toLowerCase()===e.value.toLowerCase()?(r.formatBlock=e,!1):void 0}),r.fontSizes.forEach(function(e){return r.cmdValue("fontsize")===e.value?(r.fontSize=e,!1):void 0}),r.hiliteColor=k(),u.find("button.wysiwyg-hiliteColor").css("background-color",r.hiliteColor),r.fontColor=r.cmdValue("forecolor"),g(),r.isLink=w("A")},0)})}function w(e){var t=window.getSelection().getRangeAt(0);return t&&(t.startContainer.parentNode.tagName===e.toUpperCase()||t.endContainer.parentNode.tagName===e.toUpperCase())?!0:!1}function k(){var t=window.getSelection().getRangeAt(0);if(t){var a=e.element(t.startContainer.parentNode).attr("style");if(!e.isDefined(a))return!1;for(var n=a.split(";"),i=0;i<n.length;i++){var l=n[i].split(":");if("background-color"===l[0])return l[1]}return"#fff"}return"#fff"}var x=u.find("div.wysiwyg-textarea"),C=x.next();r.isLink=!1,r.fontSizes=[{value:"1",size:"10px"},{value:"2",size:"13px"},{value:"3",size:"16px"},{value:"4",size:"18px"},{value:"5",size:"24px"},{value:"6",size:"32px"},{value:"7",size:"48px"}],r.formatBlocks=[{name:"Heading Blocks",value:"div"},{name:"Heading 1",value:"h1"},{name:"Heading 2",value:"h2"},{name:"Heading 3",value:"h3"},{name:"Heading 4",value:"h4"},{name:"Heading 5",value:"h5"},{name:"Heading 6",value:"h6"}],r.formatBlock=r.formatBlocks[0],r.fontSize=r.fontSizes[1],r.fonts=["Georgia","Palatino Linotype","Times New Roman","Arial","Helvetica","Arial Black","Comic Sans MS","Impact","Lucida Sans Unicode","Tahoma","Trebuchet MS","Verdana","Courier New","Lucida Console","Helvetica Neue"].sort(),r.font=r.fonts[6],r.htmlMode=!0,r.files={user:[],course:[]},r.imageView="file",r.changeImageView=function(e){r.imageView=e},r.selectImage=function(e){r.format("insertimage",e.url),u.find(".wysiwyg-image-uploader").addClass("hidden")},f(),m.$render=function(){x.html(m.$viewValue)},r.focus=function(){var t=e.isFunction(x.focus)?x:e.isFunction(x[0].focus)?x[0]:{focus:e.noop};t.focus()},r.format=function(e,t){document.execCommand(e,!1,t)},r.cmdState=function(e){return document.queryCommandState(e)},r.cmdValue=function(e){return document.queryCommandValue(e)},r.toggleHtml=function(){if(r.htmlMode=!r.htmlMode,r.htmlMode){var e=$("<div/>").html(C.html()).text();x.html(e),x.trigger("click"),x.trigger("input")}},r.createLink=function(){var e=prompt("Enter the link URL");e&&e!==t&&r.format("createlink",e)},r.insertImage=function(){var e=u.find(".wysiwyg-image-uploader");e.toggleClass("hidden")},r.setFont=function(){r.format("fontname",r.font)},r.setFontSize=function(){r.format("fontsize",r.fontSize.value)},r.setFormatBlock=function(){r.format("formatBlock",r.formatBlock.value)},r.setFontColor=function(){r.format("forecolor",r.fontColor)},r.setHiliteColor=function(){r.format("hiliteColor",r.hiliteColor)},r.textareaCustomFunctions=r.textareaCustomFunctions||n;for(var S in r.textareaCustomFunctions)r.textareaCustomFunctions.hasOwnProperty(S)&&(null==r[S]?r[S]=r.textareaCustomFunctions[S].bind(null,r):console.log("Cannot set custom function `"+S+"`. Already exists function or property"));r.format("enableobjectresizing",!0),r.format("styleWithCSS",!0)}return{template:'<div><style>   .wysiwyg-textarea[contentEditable="false"] { background-color:#eee}   .wysiwyg-btn-group-margin { margin-right:5px; }   .wysiwyg-select { height:30px;margin-bottom:1px;}   .wysiwyg-colorpicker { font-family: arial, sans-serif !important;font-size:16px !important; padding:2px 10px !important;}</style><div class="wysiwyg-menu"></div><div class="wysiwyg-image-uploader hidden">   <h4>Insert Image</h4>   <ul class="nav nav-tabs" style="margin-top:10px;margin-bottom:10px">       <li role="presentation" ng-class="{active:imageView === \'file\'}"><a href="javascript:void(0)" ng-click="changeImageView(\'file\')">File</a></li>       <li role="presentation" class="disabled"><a href="javascript:void(0)" ng-click="changeImageView(\'url\')">URL</a></li>       <li role="presentation" class="disabled"><a href="javascript:void(0)" ng-click="changeImageView(\'flickr\')">Flickr</a></li>   </ul>   <div ng-if="imageView === \'file\'">       <ul class="list-unstyled">           <li ng-repeat="file in files.user">               <a href="javascript:void(0)" ng-click="selectImage(file)">                   <img src="{{ file.thumbnail_url }}" /> {{ file.display_name }}               </a>           </li>       </ul>   </div></div><div id="{{textareaId}}" ng-attr-style="resize:vertical;height:{{textareaHeight || \'80px\'}}; overflow:auto" contentEditable="{{!disabled}}" class="{{textareaClass}} wysiwyg-textarea" rows="{{textareaRows}}" name="{{textareaName}}" required="{{textareaRequired}}" placeholder="{{textareaPlaceholder}}" ng-model="value" ng-show="htmlMode"></div><div ng-show="!htmlMode" ng-attr-style="resize:vertical;height:{{textareaHeight || \'80px\'}}; overflow:auto" contentEditable="{{!disabled}}" class="{{textareaClass}} wysiwyg-textarea" name="{{textareaName}}" ng-bind="value"></div></div>',restrict:"E",scope:{value:"=ngModel",textareaHeight:"@textareaHeight",textareaName:"@textareaName",textareaClass:"@textareaClass",textareaRequired:"@textareaRequired",textareaId:"@textareaId",textareaMenu:"=textareaMenu",textareaCustomMenu:"=textareaCustomMenu",fn:"&",disabled:"=?disabled",textareaCustomFunctions:"=?textareaCustomFunctions"},replace:!0,require:"ngModel",link:r,transclude:!0}}]).factory("wysiwgGui",["wysiwgGuiElements",function(t){function n(e){var t;if(e.tag)t=document.createElement(e.tag);else{if(!e.text)return console.log("cannot create",e,"element."),t=document.createElement("span");t=document.createElement("span")}if(e.text&&document.all?t.innerText=e.text:e.text&&(t.textContent=e.text),e.classes&&(t.className=e.classes),e.html&&(t.innerHTML=e.html),e.attributes&&e.attributes.length)for(var a in e.attributes){var i=e.attributes[a];i.name&&i.value&&t.setAttribute(i.name,i.value)}if(e.data&&e.data.length)for(var l in e.data)e.data.hasOwnProperty(l)&&t.appendChild(n(e.data[l]));return t}var i=t,l={},o=function(e){l=e},s=function(){return{tag:"div",classes:"btn-group btn-group-sm wysiwyg-btn-group-margin"}},r=function(e){return i[e]||{}},u=function(t){i=e.extend({},i,l),t=e.isDefined(t)&&""!==t?t:a;for(var o,u=document.createElement("div"),c=0;c<t.length;c++){for(var m=n(s()),f=0;f<t[c].length;f++)"link"===t[c][f]&&(o=n(r("unlink")),m.appendChild(o)),o=n(r(t[c][f])),m.appendChild(o);u.appendChild(m)}return u};return{createMenu:u,setCustomElements:o}}]).factory("wysiwgConfig",["wysiwgGuiElements",function(e){return{menu:a,gui:e,customFunctions:n}}]).value("wysiwgGuiElements",{bold:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Bold"},{name:"ng-click",value:"format('bold')"},{name:"ng-class",value:"{ active: isBold }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-bold"}]},italic:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Italic"},{name:"ng-click",value:"format('italic')"},{name:"ng-class",value:"{ active: isItalic }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-italic"}]},underline:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Underline"},{name:"ng-click",value:"format('underline')"},{name:"ng-class",value:"{ active: isUnderlined }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-underline"}]},strikethrough:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Strikethrough"},{name:"ng-click",value:"format('strikethrough')"},{name:"ng-class",value:"{ active: isStrikethrough }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-strikethrough"}]},subscript:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Subscript"},{name:"ng-click",value:"format('subscript')"},{name:"ng-class",value:"{ active: isSubscript }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-subscript"}]},superscript:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Superscript"},{name:"ng-click",value:"format('superscript')"},{name:"ng-class",value:"{ active: isSuperscript }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-superscript"}]},"remove-format":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Remove Formatting"},{name:"ng-click",value:"format('removeFormat')"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-eraser"}]},"ordered-list":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Ordered List"},{name:"ng-click",value:"format('insertorderedlist')"},{name:"ng-class",value:"{ active: isOrderedList }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-list-ol"}]},"unordered-list":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Unordered List"},{name:"ng-click",value:"format('insertunorderedlist')"},{name:"ng-class",value:"{ active: isUnorderedList }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-list-ul"}]},outdent:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Outdent"},{name:"ng-click",value:"format('outdent')"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-outdent"}]},indent:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Indent"},{name:"ng-click",value:"format('indent')"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-indent"}]},"left-justify":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Left Justify"},{name:"ng-click",value:"format('justifyleft')"},{name:"ng-class",value:"{ active: isLeftJustified }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-align-left"}]},"center-justify":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Center Justify"},{name:"ng-click",value:"format('justifycenter')"},{name:"ng-class",value:"{ active: isCenterJustified }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-align-center"}]},"right-justify":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Right Justify"},{name:"ng-click",value:"format('justifyright')"},{name:"ng-class",value:"{ active: isRightJustified }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-align-right"}]},code:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Code"},{name:"ng-click",value:"format('formatblock', 'pre')"},{name:"ng-class",value:"{ active: isPre }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-code"}]},quote:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Quote"},{name:"ng-click",value:"format('formatblock', 'blockquote')"},{name:"ng-class",value:"{ active: isBlockquote }"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-quote-right"}]},paragraph:{tag:"button",classes:"btn btn-default",text:"P",attributes:[{name:"title",value:"Paragragh"},{name:"ng-click",value:"format('insertParagraph')"},{name:"ng-class",value:"{ active: isParagraph }"},{name:"type",value:"button"}]},image:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Image"},{name:"ng-click",value:"insertImage()"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-picture-o"}]},"font-color":{tag:"button",classes:"btn btn-default wysiwyg-colorpicker wysiwyg-fontcolor",text:"A",attributes:[{name:"title",value:"Font Color"},{name:"colorpicker",value:"rgba"},{name:"colorpicker-position",value:"top"},{name:"ng-model",value:"fontColor"},{name:"ng-change",value:"setFontColor()"},{name:"type",value:"button"}]},"hilite-color":{tag:"button",classes:"btn btn-default wysiwyg-colorpicker wysiwyg-hilitecolor",text:"H",attributes:[{name:"title",value:"Hilite Color"},{name:"colorpicker",value:"rgba"},{name:"colorpicker-position",value:"top"},{name:"ng-model",value:"hiliteColor"},{name:"ng-change",value:"setHiliteColor()"},{name:"type",value:"button"}]},font:{tag:"select",classes:"form-control wysiwyg-select",attributes:[{name:"title",value:"Image"},{name:"ng-model",value:"font"},{name:"ng-options",value:"f for f in fonts"},{name:"ng-change",value:"setFont()"}]},"font-size":{tag:"select",classes:"form-control wysiwyg-select",attributes:[{name:"title",value:"Image"},{name:"ng-model",value:"fontSize"},{name:"ng-options",value:"f.size for f in fontSizes"},{name:"ng-change",value:"setFontSize()"}]},"format-block":{tag:"select",classes:"form-control wysiwyg-select",attributes:[{name:"title",value:"Format Block"},{name:"ng-model",value:"formatBlock"},{name:"ng-options",value:"f.name for f in formatBlocks"},{name:"ng-change",value:"setFormatBlock()"}]},link:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Link"},{name:"ng-click",value:"createLink()"},{name:"ng-show",value:"!isLink"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-link"}]},unlink:{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Unlink"},{name:"ng-click",value:"format('unlink')"},{name:"ng-show",value:"isLink"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-unlink"}]},"toggle-mode":{tag:"button",classes:"btn btn-default",attributes:[{name:"title",value:"Toggle HTML mode"},{name:"ng-click",value:"toggleHtml()"},{name:"type",value:"button"}],data:[{tag:"i",classes:"fa fa-edit"}]}})}(angular);